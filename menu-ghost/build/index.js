(()=>{"use strict";var e={n:a=>{var n=a&&a.__esModule?()=>a.default:()=>a;return e.d(n,{a:n}),n},d:(a,n)=>{for(var s in n)e.o(n,s)&&!e.o(a,s)&&Object.defineProperty(a,s,{enumerable:!0,get:n[s]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.element,n=window.wp.components,s=window.wp.i18n,t=window.ReactJSXRuntime,l=({onClick:e})=>(0,t.jsx)(n.Button,{className:"wpmc-display-conditions-button",variant:"secondary",onClick:e,children:(0,s.__)("Display Conditions","menu-ghost")}),o=(e=[])=>e.map((({value:e,label:a})=>({value:e,label:a}))),i=({value:e,options:a,onChange:s})=>(0,t.jsx)(n.SelectControl,{value:e,options:o(a),onChange:e=>s?.(e)}),r=(e=[])=>e.map((({value:e,label:a})=>({value:e,label:a}))),c=({value:e,options:a,onChange:s})=>(0,t.jsx)(n.SelectControl,{value:e,options:r(a),onChange:e=>s?.(e)}),d=(e=[])=>e.map((({value:e,label:a})=>({value:e,label:a}))),u=({value:e,options:a=[],onChange:s})=>a.length?(0,t.jsx)(n.SelectControl,{value:e,options:d(a),onChange:e=>s?.(e)}):null,m=window.wp.apiFetch;var h=e.n(m);const p=window.wp.url,g=(e,a={})=>{const n={type:e};return Object.entries(a).forEach((([e,a])=>{null!=a&&""!==a&&(n[e]=a)})),(0,p.addQueryArgs)("/menu-ghost/v1/search",n)},_=({value:e,config:l={},initialLabel:o="",onChange:i})=>{const{type:r,params:c={}}=l,[d,u]=(0,a.useState)([]),[m,_]=(0,a.useState)((()=>e&&o?{value:String(e),label:o}:null)),[v,b]=(0,a.useState)(!1),x=(0,a.useMemo)((()=>{const e=((e=[])=>[...e].reduce(((e,a)=>a&&a.value?(e.some((e=>e.value===a.value))||e.push({value:String(a.value),label:a.label||a.value}),e):e),[]))(d);return m&&m.value&&!e.some((e=>e.value===m.value))&&e.unshift(m),[{value:"",label:(0,s.__)("All","menu-ghost")},...e]}),[d,m]),y=(0,a.useCallback)(((e="")=>{r&&(b(!0),h()({path:(0,p.addQueryArgs)(g(r,c),{search:e,page:1})}).then((e=>{e&&Array.isArray(e.items)&&u(e.items)})).finally((()=>b(!1))))}),[r,c]);(0,a.useEffect)((()=>{y("")}),[y]),(0,a.useEffect)((()=>{if(!e)return void _(null);if(o)return void _({value:String(e),label:o});let a=!1;return h()({path:(0,p.addQueryArgs)(g(r,c),{id:e})}).then((e=>{var n;if(a)return;const s=null!==(n=e?.items?.[0])&&void 0!==n?n:null;s&&_({value:String(s.value),label:s.label||s.value})})).catch((()=>{a||_(null)})),()=>{a=!0}}),[e,r,c,o]);const w=(0,a.useCallback)((e=>{const a=x.find((a=>a.value===e)),n={value:null!=e?e:"",label:a?.label||""};_(!a&&e?{value:String(e),label:n.label}:a||null),i(n)}),[x,i]);return(0,t.jsx)(n.ComboboxControl,{value:e||"",onChange:w,onInputChange:e=>y(e),onFilterValueChange:e=>y(e),options:x,allowReset:!0,__nextHasNoMarginBottom:!0,__experimentalShowSelectedHint:!0,"aria-busy":v})},v=(e=[])=>e.map((({value:e,label:a})=>({value:e,label:a}))),b=({value:e,initialLabel:l,config:o={},onChange:i})=>{var r;const c=null!==(r=o.async)&&void 0!==r?r:null,d=(0,a.useMemo)((()=>{const e=Array.isArray(o.list)?o.list:[];return c||0===e.length?[]:[{value:"",label:(0,s.__)("All","menu-ghost")},...v(e)]}),[c,o.list]),u=(0,a.useCallback)((e=>{const a=d.find((a=>a.value===e));i?.({value:e,label:a?.label||""})}),[i,d]);return c?(0,t.jsx)(_,{value:e||"",config:c,initialLabel:l||"",onChange:i}):0===d.length?null:(0,t.jsx)(n.SelectControl,{value:e||"",options:d,onChange:u})},x=[{value:"include",label:(0,s.__)("Include","menu-ghost")},{value:"exclude",label:(0,s.__)("Exclude","menu-ghost")}],y=[{value:"entire_site",label:(0,s.__)("Entire Site","menu-ghost")}],w=({condition:e,conditionTypes:l,scopes:o,scopeIndex:r,onChange:d,onRemove:m})=>{var h;const p=l?.length?l:x,g=o?.length?o:y,_=(0,a.useMemo)((()=>{if(r[e.scope])return r[e.scope];const a=g[0]?.value;return a&&r[a]||{}}),[e.scope,r,g]),v=_.options||[],w=_.additionalData?.[e.subScope]||{},j=v.length>0,f=Boolean(w.async||(null!==(h=w.list?.length)&&void 0!==h?h:0));return(0,t.jsx)(n.Card,{className:"wpmc-condition-row",children:(0,t.jsxs)("div",{className:"wpmc-condition-row__controls",children:[(0,t.jsx)("div",{className:"wpmc-condition-row__field",children:(0,t.jsx)(i,{value:e.type,options:p,onChange:e=>d("type",e)})}),(0,t.jsx)("div",{className:"wpmc-condition-row__field",children:(0,t.jsx)(c,{value:e.scope,options:g,onChange:e=>d("scope",e)})}),j&&(0,t.jsx)("div",{className:"wpmc-condition-row__field",children:(0,t.jsx)(u,{value:e.subScope,options:v,onChange:e=>d("subScope",e)})}),f&&(0,t.jsx)("div",{className:"wpmc-condition-row__field",children:(0,t.jsx)(b,{value:e.additional,initialLabel:e.additionalLabel,config:w,onChange:e=>d("additional",e)})}),(0,t.jsx)(n.Button,{icon:"no-alt",label:(0,s.__)("Remove rule","menu-ghost"),onClick:m,variant:"tertiary",className:"wpmc-condition-row__remove"})]})})},j=Object.freeze({type:"include",scope:"entire_site",subScope:"",additional:"",additionalLabel:""}),f=(e="row")=>`${e}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,C=(e,a=0)=>e&&e._key?e._key:f(`row-${a}`),k=(e={})=>{const{_key:a,...n}=e;return n},S=(e=[])=>e.map(k),M=(e=[])=>{const a=Array.isArray(e)?e:[];return 0===a.length?[{...j,_key:f()}]:a.map(((e,a)=>({...j,...e,_key:C(e,a)})))},N=(0,a.forwardRef)((({initialConditions:e,value:l,pageConditions:o={conditionTypes:[],scopes:[]},onConditionsChange:i},r)=>{const c=null!=l?l:e,d=(0,a.useMemo)((()=>Object.fromEntries((o.scopes||[]).map((e=>[e.value,e])))),[o.scopes]),{rows:u,handleFieldChange:m,handleAdditionalChange:h,addRow:p,removeRow:g}=((e,n,s)=>{const[t,l]=(0,a.useState)((()=>M(e))),o=(0,a.useCallback)((e=>{"function"==typeof s&&s(e)}),[s]);return(0,a.useEffect)((()=>{l(M(e))}),[e]),{rows:t,handleFieldChange:(0,a.useCallback)(((e,a,s)=>{l((t=>{const l=t.map(((t,l)=>{if(l!==e)return t;let o={...t,[a]:s};if("scope"===a){const e=n[s]||{},a=e.options?.[0]?.value||"";o={...o,subScope:a,additional:"",additionalLabel:""}}return"subScope"===a&&(o={...o,additional:"",additionalLabel:""}),o}));return o(l),l}))}),[o,n]),handleAdditionalChange:(0,a.useCallback)(((e,a)=>{const{value:n,label:s}=(e=>e&&"object"==typeof e&&void 0!==e.value?{value:null!==e.value?String(e.value):"",label:e.label||""}:{value:e?String(e):"",label:""})(a);l((a=>{const t=a.map(((a,t)=>t===e?{...a,additional:n,additionalLabel:s}:a));return o(t),t}))}),[o]),addRow:(0,a.useCallback)((()=>{l((e=>{const a=[...e,{...j,_key:f()}];return o(a),a}))}),[o]),removeRow:(0,a.useCallback)((e=>{l((a=>{if(a.length<=1)return a;const n=a.filter(((a,n)=>n!==e));return o(n),n}))}),[o])}})(c,d,i);return(0,a.useImperativeHandle)(r,(()=>({getValue:()=>S(u)})),[u]),(0,t.jsxs)("div",{className:"wpmc-pages-tab",children:[(0,t.jsx)("div",{className:"wpmc-pages-tab__list",children:u.map(((e,a)=>(0,t.jsx)(w,{condition:e,conditionTypes:o.conditionTypes||[],scopes:o.scopes||[],scopeIndex:d,onChange:(e,n)=>{"additional"!==e?m(a,e,n):h(a,n)},onRemove:()=>g(a)},e._key)))}),(0,t.jsx)(n.Button,{variant:"secondary",onClick:p,className:"wpmc-pages-tab__add",children:(0,s.__)("Add Condition","menu-ghost")})]})})),E=N,R=({children:e})=>(0,t.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.7",strokeLinecap:"round",strokeLinejoin:"round",role:"presentation","aria-hidden":"true",children:e}),T=({name:e})=>{switch(e){case"user_role":return(0,t.jsxs)(R,{children:[(0,t.jsx)("circle",{cx:"12",cy:"9",r:"4"}),(0,t.jsx)("path",{d:"M5 20c0-4 3-7 7-7s7 3 7 7"})]});case"device":return(0,t.jsxs)(R,{children:[(0,t.jsx)("rect",{x:"8",y:"3",width:"8",height:"18",rx:"1.5"}),(0,t.jsx)("circle",{cx:"12",cy:"18",r:"0.8"})]});case"login_status":return(0,t.jsxs)(R,{children:[(0,t.jsx)("rect",{x:"6",y:"10",width:"12",height:"9",rx:"1"}),(0,t.jsx)("path",{d:"M9 10V7a3 3 0 0 1 6 0v3"})]});case"signup_date":case"within_date_range":return(0,t.jsxs)(R,{children:[(0,t.jsx)("rect",{x:"4",y:"6",width:"16",height:"14",rx:"2"}),(0,t.jsx)("path",{d:"M8 3v3M16 3v3M4 10h16M9 14h2M13 14h2M9 17h2M13 17h2"})]});case"browser_language":return(0,t.jsxs)(R,{children:[(0,t.jsx)("circle",{cx:"12",cy:"12",r:"9"}),(0,t.jsx)("path",{d:"M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18"})]});case"days_of_week":return(0,t.jsxs)(R,{children:[(0,t.jsx)("rect",{x:"3",y:"5",width:"18",height:"16",rx:"2"}),(0,t.jsx)("path",{d:"M3 9h18M7 3v2M17 3v2M7 13h2M11 13h2M15 13h2M7 17h2M11 17h2M15 17h2"})]});case"within_time":return(0,t.jsxs)(R,{children:[(0,t.jsx)("circle",{cx:"12",cy:"12",r:"9"}),(0,t.jsx)("path",{d:"M12 7v6l3 2"})]});case"url_query_key":return(0,t.jsxs)(R,{children:[(0,t.jsx)("path",{d:"M10.5 6.5 6 11l4.5 4.5"}),(0,t.jsx)("path",{d:"M13.5 6.5 18 11l-4.5 4.5"})]});case"utm_campaign":return(0,t.jsxs)(R,{children:[(0,t.jsx)("path",{d:"M4 14V6l12-3v18l-12-3"}),(0,t.jsx)("path",{d:"M4 10h12"})]});case"utm_content":return(0,t.jsxs)(R,{children:[(0,t.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),(0,t.jsx)("path",{d:"M8 8h8M8 12h8M8 16h5"})]});case"utm_medium":return(0,t.jsxs)(R,{children:[(0,t.jsx)("path",{d:"M4 13c1.5-2 3.5-3 6-3s4.5 1 6 3"}),(0,t.jsx)("path",{d:"M4 17c1.5-2 3.5-3 6-3s4.5 1 6 3"}),(0,t.jsx)("path",{d:"M4 9c1.5-2 3.5-3 6-3s4.5 1 6 3"})]});case"utm_source":return(0,t.jsxs)(R,{children:[(0,t.jsx)("path",{d:"M12 4v16"}),(0,t.jsx)("path",{d:"m7 9 5-5 5 5"})]});case"utm_term":return(0,t.jsxs)(R,{children:[(0,t.jsx)("circle",{cx:"11",cy:"11",r:"5"}),(0,t.jsx)("path",{d:"m16 16 3 3"})]});default:return(0,t.jsx)(R,{children:(0,t.jsx)("circle",{cx:"12",cy:"12",r:"9"})})}},A=({label:e,options:a=[],value:s,onChange:l,disabled:o})=>(0,t.jsxs)("div",{className:"wpmc-advanced__checkbox-group",children:[(0,t.jsx)("span",{className:"wpmc-advanced__checkbox-label",children:e}),(0,t.jsx)("div",{className:"wpmc-advanced__checkbox-grid",children:a.map((({value:e,label:a})=>(0,t.jsx)(n.CheckboxControl,{label:a,checked:s.has(e),onChange:a=>((e,a)=>{const n=new Set(s);a?n.add(e):n.delete(e),l(n)})(e,a),disabled:o},e)))})]}),P=new Set(["Tab","Shift","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"]),D=e=>{e.ctrlKey||e.metaKey||e.altKey||P.has(e.key)||e.preventDefault()},L=e=>{e.preventDefault()},O=(e,a)=>{a||"function"==typeof e.currentTarget.showPicker&&e.currentTarget.showPicker()},B=({id:e,label:a,value:s,onChange:l,disabled:o})=>(0,t.jsx)(n.BaseControl,{id:e,label:a,children:(0,t.jsx)("input",{type:"date",className:"components-text-control__input",id:e,value:s||"",onChange:e=>l(e.target.value),disabled:o,onKeyDown:D,onPaste:L,onDrop:L,onMouseDown:e=>{e.preventDefault(),O(e,o)},inputMode:"none"})}),q=({id:e,label:a,value:s,onChange:l,disabled:o})=>(0,t.jsx)(n.BaseControl,{id:e,label:a,children:(0,t.jsx)("input",{type:"time",className:"components-text-control__input",id:e,value:s||"",onChange:e=>l(e.target.value),disabled:o,onKeyDown:D,onPaste:L,onDrop:L,onMouseDown:e=>{e.preventDefault(),O(e,o)},inputMode:"none"})}),U=["utm_campaign","utm_content","utm_medium","utm_source","utm_term"],I=[{key:"audience",title:(0,s.__)("User","menu-ghost"),description:(0,s.__)("Control menu visibility based on who is visiting.","menu-ghost")},{key:"schedule",title:(0,s.__)("Date & Time","menu-ghost"),description:(0,s.__)("Schedule when links should appear.","menu-ghost")},{key:"campaign",title:(0,s.__)("URL & Campaign","menu-ghost"),description:(0,s.__)("Leverage query strings and campaign parameters.","menu-ghost")}],$=(e=[],a)=>{const n={};return a.forEach(((e,a)=>{const s=e.defaults||{};n[a]={key:a,enabled:!1,params:{...s}}})),e.forEach((e=>{e?.key&&a.has(e.key)&&(n[e.key]={...n[e.key],...e,enabled:Boolean(e.enabled),params:{...n[e.key].params,...e.params||{}}})})),n},V=e=>Object.values(e).map((({key:e,enabled:a,params:n})=>({key:e,enabled:a,params:n}))),F=(0,a.forwardRef)((({initialRules:e,rules:l,onRulesChange:o=()=>{},meta:i={}},r)=>{const c=(0,a.useMemo)((()=>(e=>[{key:"user_role",group:"audience",label:(0,s.__)("User Role","menu-ghost"),description:(0,s.__)("Only show for selected WordPress roles.","menu-ghost"),icon:"user_role",defaults:{roles:[]},editor:({params:a,setParams:n,disabled:s})=>(0,t.jsx)(A,{options:e.roles||[],value:new Set(a.roles||[]),onChange:e=>n({roles:Array.from(e)}),disabled:s})},{key:"device",group:"audience",label:(0,s.__)("User Device","menu-ghost"),description:(0,s.__)("Restrict to visitors on mobile, tablet, or desktop.","menu-ghost"),icon:"device",defaults:{devices:[]},editor:({params:a,setParams:n,disabled:s})=>(0,t.jsx)(A,{options:e.devices||[],value:new Set(a.devices||[]),onChange:e=>n({devices:Array.from(e)}),disabled:s})},{key:"login_status",group:"audience",label:(0,s.__)("Login Status","menu-ghost"),description:(0,s.__)("Target visitors who are logged in or logged out.","menu-ghost"),icon:"login_status",defaults:{state:"any"},editor:({params:e,setParams:a,disabled:l})=>(0,t.jsx)(n.SelectControl,{value:e.state||"any",options:[{value:"any",label:(0,s.__)("Any","menu-ghost")},{value:"logged_in",label:(0,s.__)("Logged in","menu-ghost")},{value:"logged_out",label:(0,s.__)("Logged out","menu-ghost")}],onChange:e=>a({state:e}),disabled:l})},{key:"signup_date",group:"audience",label:(0,s.__)("Signup Date","menu-ghost"),description:(0,s.__)("Compare against the user registration date.","menu-ghost"),icon:"signup_date",defaults:{operator:"after",date:""},editor:({params:e,setParams:a,disabled:l})=>(0,t.jsxs)("div",{className:"wpmc-advanced__input-row",children:[(0,t.jsx)(n.SelectControl,{value:e.operator||"after",options:[{value:"after",label:(0,s.__)("After","menu-ghost")},{value:"before",label:(0,s.__)("Before","menu-ghost")}],onChange:e=>a({operator:e}),disabled:l}),(0,t.jsx)(B,{id:"signup-date",value:e.date||"",onChange:e=>a({date:e}),disabled:l})]})},{key:"browser_language",group:"audience",label:(0,s.__)("Browser Language","menu-ghost"),description:(0,s.__)("Match the visitor language preference sent by the browser.","menu-ghost"),icon:"browser_language",defaults:{langs:[]},editor:({params:a,setParams:s,disabled:l})=>(0,t.jsx)(n.ComboboxControl,{value:a.langs?.[0]||"",options:(e.languages||[]).map((({value:e,label:a})=>({value:e,label:a}))),onChange:e=>s({langs:e?[e]:[]}),allowReset:!0,disabled:l})},{key:"days_of_week",group:"schedule",label:(0,s.__)("Days of the Week","menu-ghost"),description:(0,s.__)("Display only on the selected weekdays.","menu-ghost"),icon:"days_of_week",defaults:{days:[]},editor:({params:a,setParams:n,disabled:s})=>(0,t.jsx)(A,{options:e.weekdays||[],value:new Set(a.days||[]),onChange:e=>n({days:Array.from(e)}),disabled:s})},{key:"within_date_range",group:"schedule",label:(0,s.__)("Within Date Range","menu-ghost"),description:(0,s.__)("Activate only between two calendar dates.","menu-ghost"),icon:"within_date_range",defaults:{start:"",end:""},editor:({params:e,setParams:a,disabled:n})=>(0,t.jsxs)("div",{className:"wpmc-advanced__input-row",children:[(0,t.jsx)(B,{id:"within-date-start",label:(0,s.__)("Start date","menu-ghost"),value:e.start||"",onChange:e=>a({start:e}),disabled:n}),(0,t.jsx)(B,{id:"within-date-end",label:(0,s.__)("End date","menu-ghost"),value:e.end||"",onChange:e=>a({end:e}),disabled:n})]})},{key:"within_time",group:"schedule",label:(0,s.__)("Within Time Window","menu-ghost"),description:(0,s.__)("Activate during the selected time of day.","menu-ghost"),icon:"within_time",defaults:{start:"",end:""},editor:({params:e,setParams:a,disabled:n})=>(0,t.jsxs)("div",{className:"wpmc-advanced__input-row",children:[(0,t.jsx)(q,{id:"within-time-start",label:(0,s.__)("Start time","menu-ghost"),value:e.start||"",onChange:e=>a({start:e}),disabled:n}),(0,t.jsx)(q,{id:"within-time-end",label:(0,s.__)("End time","menu-ghost"),value:e.end||"",onChange:e=>a({end:e}),disabled:n})]})},{key:"url_query_key",group:"campaign",label:(0,s.__)("URL Query Parameter","menu-ghost"),description:(0,s.__)("Check for a specific query-string key/value.","menu-ghost"),icon:"url_query_key",defaults:{mode:"exists",key:"",value:""},editor:({params:e,setParams:a,disabled:l})=>(0,t.jsxs)("div",{className:"wpmc-advanced__input-row",children:[(0,t.jsx)(n.SelectControl,{label:(0,s.__)("Mode","menu-ghost"),value:e.mode||"exists",options:[{value:"exists",label:(0,s.__)("Exists","menu-ghost")},{value:"equals",label:(0,s.__)("Equals","menu-ghost")}],onChange:e=>a({mode:e}),disabled:l}),(0,t.jsx)(n.TextControl,{label:(0,s.__)("Key","menu-ghost"),value:e.key||"",onChange:e=>a({key:e}),disabled:l}),(0,t.jsx)(n.TextControl,{label:(0,s.__)("Value","menu-ghost"),value:e.value||"",onChange:e=>a({value:e}),disabled:l})]})},...U.map((e=>({key:e,group:"campaign",label:e.replace("utm_","UTM ").replace(/\b\w/g,(e=>e.toUpperCase())),description:(0,s.__)("Require a matching campaign parameter.","menu-ghost"),icon:e,defaults:{mode:"exists",value:""},editor:({params:e,setParams:a,disabled:l})=>(0,t.jsxs)("div",{className:"wpmc-advanced__input-row",children:[(0,t.jsx)(n.SelectControl,{label:(0,s.__)("Mode","menu-ghost"),value:e.mode||"exists",options:[{value:"exists",label:(0,s.__)("Exists","menu-ghost")},{value:"equals",label:(0,s.__)("Equals","menu-ghost")}],onChange:e=>a({mode:e}),disabled:l}),(0,t.jsx)(n.TextControl,{label:(0,s.__)("Value","menu-ghost"),value:e.value||"",onChange:e=>a({value:e}),disabled:l})]})})))])(i)),[i]),d=(0,a.useMemo)((()=>{const e=new Map;return c.forEach((a=>{e.set(a.key,a)})),e}),[c]),u=null!=l?l:e,[m,h]=(0,a.useState)((()=>$(u,d))),p=(0,a.useRef)(!1),[g,_]=(0,a.useState)({key:null,anchor:null}),v=(0,a.useRef)(null),[b,x]=(0,a.useState)({}),y=(0,a.useRef)({}),w=(0,a.useMemo)((()=>I.map((e=>({...e,definitions:c.filter((a=>a.group===e.key))}))).filter((e=>e.definitions.length>0))),[c]),[j,f]=(0,a.useState)((()=>{var e;return null!==(e=w[0]?.key)&&void 0!==e?e:null}));(0,a.useEffect)((()=>{p.current=!0,Object.keys(y.current).forEach((e=>{clearTimeout(y.current[e]),delete y.current[e]})),x({}),h($(u,d))}),[u,d]),(0,a.useEffect)((()=>{w.length?j&&w.some((e=>e.key===j))||f(w[0].key):f(null)}),[w,j]);const C=(0,a.useCallback)((e=>{y.current[e]&&clearTimeout(y.current[e]),x((a=>({...a,[e]:!1}))),y.current[e]=setTimeout((()=>{x((a=>({...a,[e]:!0}))),clearTimeout(y.current[e]),delete y.current[e]}),250)}),[]),k=(0,a.useCallback)((e=>{y.current[e]&&(clearTimeout(y.current[e]),delete y.current[e]),x((a=>{if(void 0===a[e])return a;const n={...a};return delete n[e],n}))}),[]),S=(0,a.useCallback)((()=>{v.current&&(clearTimeout(v.current),v.current=null),_({key:null,anchor:null})}),[]),M=(0,a.useCallback)((e=>{S(),f((a=>a===e?a:e))}),[S]);(0,a.useEffect)((()=>{S()}),[j,S]),(0,a.useEffect)((()=>()=>{v.current&&clearTimeout(v.current)}),[]),(0,a.useEffect)((()=>{Object.entries(m).forEach((([e,a])=>{a?.enabled?k(e):C(e)}))}),[m,C,k]),(0,a.useEffect)((()=>()=>{Object.keys(y.current).forEach((e=>{clearTimeout(y.current[e]),delete y.current[e]}))}),[]),(0,a.useEffect)((()=>{g.key&&(c.some((e=>e.key===g.key))||S())}),[g.key,c,S]),(0,a.useImperativeHandle)(r,(()=>({getValue:()=>V(m)})),[m]);const N=(0,a.useCallback)((e=>{h((a=>e(a)))}),[]);(0,a.useEffect)((()=>{p.current?p.current=!1:o(V(m))}),[m,o]);const E=(0,a.useCallback)(((e,a)=>{a?k(e):C(e),N((n=>({...n,[e]:{...n[e],enabled:a}})))}),[k,C,N]),R=(0,a.useCallback)(((e,a)=>{N((n=>({...n,[e]:{...n[e],params:{...n[e].params,...a}}})))}),[N]),P=(0,a.useCallback)((e=>a=>{v.current&&(clearTimeout(v.current),v.current=null);const n=a.currentTarget;_((a=>a.key===e&&a.anchor===n?a:{key:e,anchor:n}))}),[]),D=(0,a.useCallback)((()=>{v.current&&clearTimeout(v.current),v.current=setTimeout((()=>{_({key:null,anchor:null}),v.current=null}),140)}),[]);return(0,t.jsx)("div",{className:"wpmc-advanced",children:(0,t.jsx)("div",{className:"wpmc-advanced__accordions",children:w.map((e=>{const a=!!j&&j===e.key,s=`group:${e.key}`,l=`wpmc-advanced-panel-${e.key}`;return(0,t.jsxs)("section",{className:"wpmc-advanced__accordion"+(a?" is-open":""),children:[(0,t.jsxs)("button",{type:"button",className:"wpmc-advanced__accordion-toggle",onClick:()=>M(e.key),"aria-expanded":a,"aria-controls":l,children:[(0,t.jsx)("span",{className:"wpmc-advanced__accordion-label",children:(0,t.jsx)("span",{className:"wpmc-advanced__accordion-title",children:e.title})}),(0,t.jsx)("span",{className:"wpmc-advanced__accordion-icon","aria-hidden":"true"})]}),g.key===s&&g.anchor&&(0,t.jsx)(n.Popover,{anchor:g.anchor,onClose:S,className:"wpmc-advanced__info-popover",children:(0,t.jsx)("p",{children:e.description})}),(0,t.jsx)("div",{id:l,className:"wpmc-advanced__accordion-panel","aria-hidden":!a,children:(0,t.jsx)("div",{className:"wpmc-advanced__panel-inner",children:e.definitions.map((e=>{const a=m[e.key]||{enabled:!1,params:e.defaults},s=!a.enabled&&!0===b[e.key];return(0,t.jsxs)(n.Card,{className:"wpmc-advanced__card"+(a.enabled?" is-active":""),children:[(0,t.jsxs)(n.CardHeader,{className:"wpmc-advanced__card-header",children:[(0,t.jsxs)("div",{className:"wpmc-advanced__title",children:[(0,t.jsx)("span",{className:"wpmc-advanced__rule-icon",children:(0,t.jsx)(T,{name:e.icon})}),(0,t.jsx)("h3",{children:e.label}),e.description&&(0,t.jsx)(n.Button,{className:"wpmc-advanced__info-button",icon:"editor-help",onMouseEnter:P(e.key),onMouseLeave:D,onFocus:P(e.key),onBlur:D,variant:"tertiary"}),g.key===e.key&&g.anchor&&(0,t.jsx)(n.Popover,{anchor:g.anchor,onClose:S,className:"wpmc-advanced__info-popover",children:(0,t.jsx)("p",{children:e.description})})]}),(0,t.jsx)(n.ToggleControl,{className:"wpmc-advanced__toggle",checked:!!a.enabled,onChange:a=>E(e.key,a)})]}),(0,t.jsx)(n.CardBody,{className:"wpmc-advanced__card-body"+(a.enabled?" is-open":" is-collapsed"),"aria-hidden":!a.enabled,children:e.editor({params:a.params,setParams:a=>R(e.key,a),disabled:s})})]},e.key)}))})})]},e.key)}))})})})),H=e=>{const[n,s]=(0,a.useState)(e);return(0,a.useEffect)((()=>{s(e)}),[e]),[n,s]},K=({tabs:e})=>{const a=Object.fromEntries(e.map((e=>[e.name,e])));return(0,t.jsx)(n.TabPanel,{className:"wpmc-conditions-modal__tabs",activeClass:"is-active",orientation:"horizontal",tabs:e.map((({name:e,title:a})=>({name:e,title:a}))),children:e=>{var n;const s=a[e.name];return s?(0,t.jsx)("div",{className:"wpmc-conditions-modal__tab",children:(0,t.jsx)("div",{className:"wpmc-conditions-modal__content",children:"function"==typeof s.render?s.render():null!==(n=s.content)&&void 0!==n?n:null})}):null}})},W=({onCancel:e,onSave:a,saving:l})=>(0,t.jsxs)("footer",{className:"wpmc-conditions-modal__footer",children:[(0,t.jsx)(n.Button,{variant:"secondary",onClick:e,disabled:l,children:(0,s.__)("Cancel","menu-ghost")}),(0,t.jsx)(n.Button,{variant:"primary",className:"wpmc-conditions-modal__save",onClick:a,disabled:l,children:l?(0,s.__)("Savingâ€¦","menu-ghost"):(0,s.__)("Save & Close","menu-ghost")})]}),Q=({message:e,onRemove:a})=>e?(0,t.jsx)(n.Notice,{className:"wpmc-conditions-modal__notice",status:"error",onRemove:a,isDismissible:!0,children:e}):null,J={name:"pages",title:(0,s.__)("Pages","menu-ghost")},z={name:"advanced",title:(0,s.__)("Advanced Rules","menu-ghost")},X=({menuTitle:e,pageConditions:l,advancedMeta:o,initialPages:i,initialAdvanced:r,onRequestClose:c,onSave:d})=>{const[u,m]=H(i),[h,p]=H(r),[g,_]=(0,a.useState)(!1),[v,b]=(0,a.useState)(null),x=(0,a.useMemo)((()=>e?(0,s.sprintf)(/* translators: %s: menu item title. */ /* translators: %s: menu item title. */
(0,s.__)("%s - Display Conditions","menu-ghost"),e):(0,s.__)("Display Conditions","menu-ghost")),[e]),y=(0,a.useCallback)((async()=>{var e;const a={pages:null!==(e=S(u))&&void 0!==e?e:[],advanced:null!=h?h:[]};_(!0),b(null);const n=await d(a)||{};_(!1),n.ok||b(n.error?.message||(0,s.__)("Unable to save changes. Please try again.","menu-ghost"))}),[h,d,u]),w=(0,a.useMemo)((()=>[{...J,render:()=>(0,t.jsx)(E,{initialConditions:i,value:u,pageConditions:l,onConditionsChange:m})},{...z,render:()=>(0,t.jsx)(F,{initialRules:r,rules:h,meta:o,onRulesChange:p})}]),[h,o,r,i,l,u,p,m]);return(0,t.jsx)(n.Modal,{title:x,className:"wpmc-conditions-modal",onRequestClose:g?void 0:c,shouldCloseOnClickOutside:!g,shouldCloseOnEsc:!g,children:(0,t.jsxs)("div",{className:"wpmc-conditions-modal__inner",children:[(0,t.jsx)(K,{tabs:w}),(0,t.jsx)(Q,{message:v,onRemove:()=>b(null)}),(0,t.jsx)(W,{onCancel:c,onSave:y,saving:g})]})})},G=({itemId:e,menuTitle:n,pageConditions:s,advancedMeta:o,initialPages:i,initialAdvanced:r,ajaxUrl:c,nonce:d})=>{const[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(i),[g,_]=(0,a.useState)(r);(0,a.useEffect)((()=>p(i)),[i]),(0,a.useEffect)((()=>_(r)),[r]);const v=(0,a.useCallback)((async({pages:a,advanced:n})=>{if(!c)return p(a),_(n),m(!1),{ok:!0};const s=new URLSearchParams;s.append("action","mghost_save_menu_settings"),d&&s.append("nonce",d),s.append("itemId",String(e)),s.append("pages",JSON.stringify(a)),s.append("advanced",JSON.stringify(n));try{const e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:s.toString()});if(!e.ok)throw new Error(`Request failed with status ${e.status}`);const t=await e.json();if(!t?.success)throw new Error(t?.data?.message||"Unknown error");return p(a),_(n),m(!1),{ok:!0}}catch(e){return{ok:!1,error:e}}}),[c,e,d]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l,{onClick:()=>m(!0)}),u&&(0,t.jsx)(X,{menuTitle:n,pageConditions:s,advancedMeta:o,initialPages:h,initialAdvanced:g,onRequestClose:()=>m(!1),onSave:v})]})},Y=window.menu_ghost||{},{menu_items:Z=[],page_conditions:ee,advanced_meta:ae,saved_settings:ne={},ajax_url:se,nonce:te}=Y,le=ee||{conditionTypes:[],scopes:[]};Z.forEach((({id:e,title:n})=>{const s=`menu-ghost-${e}`,l=document.getElementById(s);if(!l)return;const o=ne[e]||{pages:[],advanced:[]},i=(0,t.jsx)(G,{itemId:e,menuTitle:n,pageConditions:le,advancedMeta:ae,initialPages:o.pages||[],initialAdvanced:o.advanced||[],ajaxUrl:se,nonce:te});a.createRoot?(0,a.createRoot)(l).render(i):(0,a.render)(i,l)}))})();